erDiagram
    PATIENT {
        int patient_id PK
        string first_name
        string middle_name
        string last_name
        string maternal_surname
        date birth_date
        string gender
        string email
        datetime registration_date
        boolean is_active
    }
    
    DOCUMENT_TYPE {
        int document_type_id PK
        string code
        string name
        string description
    }
    
    PATIENT_DOCUMENT {
        int patient_id FK
        int document_type_id FK
        string document_number
        string issuing_country
        date issue_date
    }
    
    PATIENT_ADDRESS {
        int address_id PK
        int patient_id FK
        string address_type
        string department
        string municipality
        string address_line
        decimal latitude
        decimal longitude
        string postal_code
    }
    
    PATIENT_PHONE {
        int phone_id PK
        int patient_id FK
        string phone_type
        string number
        boolean is_primary
    }
    
    EMERGENCY_CONTACT {
        int contact_id PK
        int patient_id FK
        string name
        string relationship
        string phone
        string email
        text instructions
    }
    
    ALLERGY {
        int allergy_id PK
        int patient_id FK
        int medication_id FK
        string allergy_type
        string description
        string severity
        datetime registration_date
    }
    
    PHYSICIAN {
        int physician_id PK
        string internal_code
        string medical_license_number
        string first_name
        string last_name
        string professional_email
        date hospital_admission_date
        boolean is_active
    }
    
    SPECIALTY {
        int specialty_id PK
        string code
        string name
        string description
    }
    
    PHYSICIAN_SPECIALTY {
        int physician_id FK
        int specialty_id FK
        date assignment_date
        boolean is_active
    }
    
    PHYSICIAN_ADDRESS {
        int address_id PK
        int physician_id FK
        string address_type
        string department
        string municipality
        string address_line
        string office_hours
    }
    
    PHYSICIAN_PHONE {
        int phone_id PK
        int physician_id FK
        string phone_type
        string number
    }
    
    PHYSICIAN_SCHEDULE {
        int schedule_id PK
        int physician_id FK
        int day_of_week
        time start_time
        time end_time
        string modality
    }
    
    ROOM {
        int room_id PK
        string code
        string name
        string room_type
        int capacity
        boolean is_active
    }
    
    APPOINTMENT {
        int appointment_id PK
        int patient_id FK
        int physician_id FK
        int room_id FK
        date appointment_date
        time start_time
        time end_time
        string appointment_type
        string status
        text reason
        int created_by FK
        datetime creation_date
    }
    
    MEDICAL_RECORD {
        int record_id PK
        int patient_id FK
        int professional_id FK
        int appointment_id FK
        datetime record_timestamp
        string record_type
        text summary_text
        jsonb structured_summary
        int primary_diagnosis_id FK
        string integrity_hash
    }
    
    DIAGNOSIS {
        int diagnosis_id PK
        string icd_code
        string description
        string version
    }
    
    RECORD_DIAGNOSIS {
        int record_id FK
        int diagnosis_id FK
        string diagnosis_type
        text observations
    }
    
    VITAL_SIGN {
        int vital_sign_id PK
        int record_id FK
        string sign_type
        decimal value
        string unit
        datetime measurement_timestamp
    }
    
    MEDICATION {
        int medication_id PK
        string atc_code
        string brand_name
        string active_ingredient
        string presentation
        string version
    }
    
    PRESCRIPTION {
        int prescription_id PK
        int record_id FK
        int medication_id FK
        int professional_id FK
        string dosage
        string frequency
        string duration
        text instructions
        datetime prescription_date
        boolean is_validated
    }
    
    PROCEDURE {
        int procedure_id PK
        string code
        string description
        decimal reference_price
    }
    
    INSURANCE_COMPANY {
        int insurance_id PK
        string name
        string contact_name
        string email
        string phone
    }
    
    POLICY {
        int policy_id PK
        int patient_id FK
        int insurance_id FK
        string policy_number
        text coverage_summary
        date start_date
        date end_date
        string status
    }
    
    USER {
        int user_id PK
        string username
        string email
        string role
        boolean is_active
        datetime creation_date
    }
    
    AUDIT_LOG {
        int audit_id PK
        int user_id FK
        string role
        string entity
        int entity_id
        string action
        json details
        datetime timestamp
        string ip_address
        string application
    }
    
    PATIENT ||--o{ PATIENT_DOCUMENT : "has"
    DOCUMENT_TYPE ||--o{ PATIENT_DOCUMENT : "identifies"
    PATIENT ||--o{ PATIENT_ADDRESS : "resides_at"
    PATIENT ||--o{ PATIENT_PHONE : "has"
    PATIENT ||--o{ EMERGENCY_CONTACT : "has"
    PATIENT ||--o{ ALLERGY : "suffers_from"
    
    PHYSICIAN ||--o{ PHYSICIAN_SPECIALTY : "has"
    SPECIALTY ||--o{ PHYSICIAN_SPECIALTY : "assigned_to"
    PHYSICIAN ||--o{ PHYSICIAN_ADDRESS : "practices_at"
    PHYSICIAN ||--o{ PHYSICIAN_PHONE : "contacted_by"
    PHYSICIAN ||--o{ PHYSICIAN_SCHEDULE : "available_on"
    
    PATIENT ||--o{ APPOINTMENT : "requests"
    PHYSICIAN ||--o{ APPOINTMENT : "attends"
    ROOM ||--o{ APPOINTMENT : "hosts"
    USER ||--o{ APPOINTMENT : "creates"
    
    PATIENT ||--o{ MEDICAL_RECORD : "owns"
    PHYSICIAN ||--o{ MEDICAL_RECORD : "registers"
    APPOINTMENT ||--o| MEDICAL_RECORD : "generates"
    
    MEDICAL_RECORD ||--o{ RECORD_DIAGNOSIS : "contains"
    DIAGNOSIS ||--o{ RECORD_DIAGNOSIS : "associated_with"
    MEDICAL_RECORD ||--o{ VITAL_SIGN : "records"
    
    MEDICAL_RECORD ||--o{ PRESCRIPTION : "includes"
    MEDICATION ||--o{ PRESCRIPTION : "prescribed_in"
    PHYSICIAN ||--o{ PRESCRIPTION : "prescribes"
    MEDICATION ||--o{ ALLERGY : "may_cause"
    
    PATIENT ||--o{ POLICY : "holds"
    INSURANCE_COMPANY ||--o{ POLICY : "issues"
    
    USER ||--o{ AUDIT_LOG : "generates"